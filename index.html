<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Generated by GameMaker:Studio http://www.yoyogames.com/gamemaker/studio -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta charset="utf-8" />

    <!-- Set the title bar of the page -->
    <title>BET BET BET!!!!</title>

    <!-- Set the background colour of the document -->
</head>


<body>
    <div id="num"></div>
</body>


<script>
    let php_convert = Number(localStorage.getItem("bt_val")) || 180000
    let trial_init = Number(localStorage.getItem("roll_attempts")) || 100000;
    let trial_count = trial_init;
    let previous = null;
    let streak = 1;
    let max_streak = 1;
    let streak_count = {};

    let balance_divider = 100000;
    let balance_init = Number(localStorage.getItem("init_balance")) || 15000;
    let balance_ceil = Number(localStorage.getItem("ceil_balance")) || 5000;
    let balance = balance_init;
    let balance_safe = 0;

    let bet = Number(localStorage.getItem("first_bet")) || 5;
    let bet_combo = 1;
    let valid = true;
    let last_bet = 0;

    let secs_per_roll = Number(localStorage.getItem("secs_per")) || 10;
    let hrs_per_day = Number(localStorage.getItem("hrs_per")) || 2;
    let days_per_month = Number(localStorage.getItem("days_per")) || 20;



    let display = `<table>`;
    let linebreak = `<tr><td>-----------</td><td>-----------</td></tr>`;

    function numberWithCommas(x) {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ", ");
    }

    const genInput = (id, placeholder) => {
        return `<input id="` + id + `" placeholder="` + placeholder + `">`
    }

    const saveSettings = () => {
        let bt_val = document.getElementById("bt_val").value;
        let rolls = document.getElementById("roll_attempts").value;
        let init = document.getElementById("init_balance").value;
        let ceil = document.getElementById("ceil_balance").value;
        let first_bet = document.getElementById("first_bet").value;

        let secs_per = document.getElementById("secs_per").value;
        let hrs_per = document.getElementById("hrs_per").value;
        let days_per = document.getElementById("days_per").value;


        if (secs_per != "") {
            localStorage.setItem("secs_per", secs_per)
        }

        if (hrs_per != "") {
            localStorage.setItem("hrs_per", hrs_per)
        }

        if (days_per != "") {
            localStorage.setItem("days_per", days_per)
        }

        if (bt_val != "") {
            localStorage.setItem("bt_val", bt_val)
        }

        if (rolls != "") {
            localStorage.setItem("roll_attempts", rolls)
        }

        if (init != "") {
            localStorage.setItem("init_balance", Number(init) * balance_divider)
        }

        if (ceil != "") {
            localStorage.setItem("ceil_balance", Number(ceil) * balance_divider)
        }

        if (first_bet != "") {
            localStorage.setItem("first_bet", Number(first_bet) * balance_divider)
        }

        window.location.reload();
    }

    display += `<tr>
        <td>bitcoint value</td>
        <td>`+ genInput("bt_val", php_convert + " php") + `</td>
    </tr>`

    display += `<tr>
        <td>roll attempts</td>
        <td>`+ genInput("roll_attempts", trial_init + " rolls") + `</td>
    </tr>`

    let bal_div = (balance / balance_divider);

    display += `<tr>
        <td>initial balance</td>
        <td>`+ genInput("init_balance", bal_div + " bt -> (" + (bal_div * php_convert) + " php)") + `</td>
    </tr>`

    let bac_div = (balance_ceil / balance_divider)

    display += `<tr>
        <td>safety balance</td>
        <td>`+ genInput("ceil_balance", bac_div + " bt -> (" + (bac_div * php_convert) + " php)") + `</td>
    </tr>`

    let bet_div = (bet / balance_divider)

    display += `<tr>
        <td>initial bet</td>
        <td>`  + genInput("first_bet", bet_div + " bt -> (" + (bet_div * php_convert) + " php)") + ` </td>
    </tr>`


    display += `<tr>
        <td>secs per roll</td>
        <td>`  + genInput("secs_per", secs_per_roll + " secs") + ` </td>
    </tr>`

    display += `<tr>
        <td>hrs per day</td>
        <td>`  + genInput("hrs_per", hrs_per_day + " hrs") + ` </td>
    </tr>`

    display += `<tr>
        <td>days per month</td>
        <td>`  + genInput("days_per", days_per_month + " days") + ` </td>
    </tr>`



    display += `<tr>
        <td>save settings</td>
        <td><button onClick="saveSettings()"> save </button></td>
    </tr>`;


    display += linebreak;

    let hours = Math.round(((trial_init * secs_per_roll) / (60 * 60)) * 100) / 100;

    display += `<tr>
        <td>average time</td>
        <td>`+ hours + ` hrs</td>
    </tr>`



    display += `<tr>
        <td>average days </td>
        <td>`+ Math.round((hours / hrs_per_day) * 100) / 100 + ` days</td>
    </tr>`

    let month_count = Math.round((hours / (hrs_per_day * days_per_month)) * 100) / 100

    display += `<tr>
        <td>average months </td>
        <td>`+ month_count + ` months</td>
    </tr>`

    display += linebreak;

    display += `<tr>
        <td>Streak count</td>
        <td></td>
    </tr>`

    while (trial_count > 0 && valid) {
        let result = Boolean(Math.random() * 100 <= 49.5);
        if (result == previous) {
            streak++;
            if (streak > max_streak) {
                max_streak = streak
            }
        } else {
            if (streak_count[String(streak)] == null) { streak_count[String(streak)] = 1 }
            else { streak_count[String(streak)] += 1 }
            streak = 1;
        }

        if (result) {
            balance += Math.pow(2, bet_combo) * bet;
            if (balance > balance_init + balance_ceil) {
                let store = balance - balance_init;
                balance -= store;
                balance_safe += store;
            }
            bet_combo = 1;
        } else {
            last_bet = Math.pow(2, bet_combo) * bet;
            if (balance - last_bet < 0) {
                bet_combo = 0;
                last_bet = Math.pow(2, bet_combo) * bet;
            }
            balance -= last_bet;
            bet_combo++
            if (balance < bet) {
                if (balance_safe > balance_ceil) {
                    balance_safe -= balance_ceil;
                    balance += balance_ceil
                    bet_combo = 0;
                } else {
                    valid = false
                }
            }
        }

        previous = result;
        trial_count--;
    }

    Object.keys(streak_count).forEach((num) => {
        display += `<tr>
            <td>`+ num + `</td>
            <td> | `+ streak_count[num] + `</td>
        </tr>`
    })

    display += linebreak;

    display += `<tr>
        <td>buyback for highes streak</td>
        <td> | `+ (((bet * (Math.pow(2, max_streak + 1))) - bet) / balance_divider) + ` bt</td>
    </tr>`

    let total_balance = (balance + balance_safe);

    let balance_text = (total_balance / balance_divider) + " bt"

    if (!valid) { balance_text += (" <i>stopped at trial no. " + String(trial_init - trial_count)) + "</i> <br>| last bet cost was " + (last_bet / balance_divider) + " bt" }

    display += `<tr>
        <td>end balance</td>
        <td style="color:#`+ (total_balance > balance_init ? `00cc66` : `ff0000`) + `"> | ` + (balance_text) + `</td>
    </tr>`

    display += linebreak;

    let total_earnings = ((total_balance - balance_init) / balance_divider) * php_convert;

    display += `<tr>
        <td><b>PHP EARNINGS</b></td>
        <td ><b>` + numberWithCommas(Math.floor(total_earnings)) + ` php</b></td>
    </tr>`

    display += `<tr>
        <td><b>PER MONTH</b></td>
        <td ><b>` + numberWithCommas(Math.floor((total_earnings / month_count))) + ` php</b></td>
    </tr>`

    display += `</table>`
    document.getElementById("num").innerHTML = display
</script>

</html>